<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
  <h2>Hi {{ current_user.username }} ğŸ‘‹</h2>

  <h2>Today's Plan</h2>

  {% if not plan_exists and not locked %}
  <p>No plan for today.</p>
  <a href="/plan">
    <button>Create Today's Plan</button>
  </a>
  {% elif not plan_exists and locked %}
  <p>â³ Planning is locked for today</p>
  {% endif %}

  <h3>Timeline</h3>

  <div class="timeline">
    {% for task in tasks %}
    <div class="timeline-task
      {% if task.status == 'completed' %}done
      {% elif task.status == 'active' %}active
      {% else %}planned{% endif %}
    " style="
      top: {{ (task.expected_start.hour * 60 + task.expected_start.minute) / 1440 * 100 }}%;
      height: {{ ((task.expected_end.hour * 60 + task.expected_end.minute)
                 - (task.expected_start.hour * 60 + task.expected_start.minute))
                 / 1440 * 100 }}%;
    ">
      <strong>{{ task.title }}</strong><br>
      <small>
        {{ task.expected_start.strftime('%H:%M') }}
        â€“
        {{ task.expected_end.strftime('%H:%M') }}
      </small>
    </div>
    {% endfor %}
  </div>



  {% for task in tasks %}
  <div class="task">
    <h3>{{ task.title }}</h3>
    <p>{{ task.description }}</p>
    <small>
      ğŸ•’ {{ task.expected_start.strftime('%H:%M') }}
      â€“
      {{ task.expected_end.strftime('%H:%M') }}
    </small>


    {% if task.status == 'pending' %}
    <button onclick="startTask({{ task.id }})">Start</button>
    {% elif task.status == 'active' %}
    <button onclick="completeTask({{ task.id }})">Complete</button>
    {% else %}
    <span>Done âœ”</span>
    {% endif %}
  </div>
  {% endfor %}

  {% if summary %}
  <hr>
  <h3>Yesterday</h3>
  <p>Completion: {{ summary.percent }}%</p>
  <p>Planned Time: {{ summary.planned }} min</p>
  <p>Actual Time: {{ summary.actual }} min</p>
  <p>Time Saved: {{ summary.saved }} min</p>
  {% endif %}


  <hr>

  <h3>Add Friend</h3>
  <form method="POST" action="/add-friend">
    <input name="username" placeholder="Friend username" required>
    <button>Add</button>
  </form>

  <hr>

  <h3>Friend Progress</h3>

  {% for friend, tasks in friends_data %}
  <h4>{{ friend.username }}</h4>
  {% if tasks %}
  {% for t in tasks %}
  <div class="task">
    {{ t.title }} â€” {{ t.status }}
    <br>
    <small>
      ğŸ•’ {{ t.expected_start.strftime('%H:%M') }}
      â€“
      {{ t.expected_end.strftime('%H:%M') }}
    </small>

  </div>
  {% endfor %}
  {% else %}
  <p>No plan today</p>
  {% endif %}
  {% endfor %}

  <script src="/static/js/app.js"></script>
</body>

</html>